# Configuration
> [!IMPORTANT]
> Due to the plugin's ability to simulate input and run commands, you may want to restrict write access to the configuration file.

> [!IMPORTANT]
> Until v1.0.0 is released, breaking changes may be introduced at any time.

This page only explains the configuration structure, to learn how certain features of the plugin actually work, see [index.md](index.md).

There is currently no configuration UI. The configuration file is located at ``~/.config/kwingestures.yml``. It is created automatically when the plugin is loaded. The plugin should be reconfigured when the file changes. If it doesn't, disable and enable it manually or run ``qdbus org.kde.KWin /Effects org.kde.kwin.Effects.reconfigureEffect kwin_gestures``.

When the configuration fails to load, the error will be logged. To see it, run ``journalctl --boot=0 -g "kwin_gestures:" -n 5``. The message should contain the approximate position of where the error has occurred.
```
kwin_gestures: Failed to load configuration: Invalid swipe direction (line 4, column 17)
```

# Configuration file structure
Bolded properties must be set.

## Types
| Type                       | Description                                                                                                        |
|----------------------------|--------------------------------------------------------------------------------------------------------------------|
| bool                       | *true* or *false*                                                                                                  |
| int                        | A positive or negative number.                                                                                     |
| uint                       | A positive number.                                                                                                 |
| float                      | A positive or negative number with decimal places.                                                                 |
| list(type)                 | List containing elements of *type*.<br><br>Example: ``list(int)`` - ``[ 1, 2, 3 ]`` or:<br>- 1<br>- 2<br>- 3       |
| range(type)                | A range of numbers of *type*. Format: ``min-max``.<br><br>Example: ``range(int)`` - ``1-2``                        |
| enum(value1, value2, ...)  | A single value from the list of valid values in brackets.                                                          |
| flags(value1, value2, ...) | A list of one or multiple values from the list of valid values in brackets.<br><br>Example: ``[ value1, value2 ]`` | 

## Root
| Property    | Type       | Description                                                                | Default |
|-------------|------------|----------------------------------------------------------------------------|---------|
| autoreload  | ``bool``   | Whether the configuration should be automatically reloaded on file change. | *true*  |
| mouse       | ``Device`` | See <a href="#device">*Device*</a> below.                                  |         |
| touchpad    | ``Device`` | See <a href="#device">*Device*</a> below.                                  |         |

## Device
The device is the root element in the configuration file:
```yaml
mouse:
  gestures:
    # ...
  
touchpad:
  gestures:
    # ...
```

| Property         | Type              | Description                                                                                                                                                                                                                                              | Default |
|------------------|-------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|
| **gestures**     | ``list(Gesture)`` | Gestures for this device. See <a href="#gesture">*Gesture*</a> below.                                                                                                                                                                                    | *none*  |
| speed            | ``Speed``         | Settings for how gesture speed is determined. See <a href="#speed">*Speed*</a> below.                                                                                                                                                                    |         |
| delta_multiplier | ``float``         | Delta multiplier used for *move_by_delta* mouse input actions.                                                                                                                                                                                           | *1.0*   |
| gesture_timeout  | ``float``         | The time in milliseconds during which a swipe or wheel gesture must be performed. If not, a press gesture will be started. If no press gestures are activated, all pressed mouse buttons will actually be pressed, after having been blocked previously. | *200*   |
| button_timeout   | ``float``         | The time in milliseconds during which press gestures are not started in case the user presses more than one mouse button.<br><br>Swipe and wheel gesture aren't affected by this option.                                                                 | *50*    |

## Speed
The defaults may not work for everyone, as they depend on the device's sensitivity and size.

| Property            | Type      | Description                                                                                                                                                                                                                                                                                                                                                           | Default |
|---------------------|-----------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|
| events              | ``uint``  | How many input events to sample in order to determine the speed at which the gesture is performed. The average of each event's delta is compared against the thresholds below. If the threshold is reached, the gesture is considered to have been performed fast, otherwise slow.<br><br>**Note**: No gestures will be triggered until all events have been sampled. | *3*     |
| swipe_threshold     | ``float`` |                                                                                                                                                                                                                                                                                                                                                                       | *20*    |
| pinch_in_threshold  | ``float`` |                                                                                                                                                                                                                                                                                                                                                                       | *0.04*  |
| pinch_out_threshold | ``float`` |                                                                                                                                                                                                                                                                                                                                                                       | *0.08*  |
| rotate_threshold    | ``float`` |                                                                                                                                                                                                                                                                                                                                                                       | *5*     |

## Gesture
See [example_gestures.md](example_gestures.md) for examples.

| Property           | Type                                                                                | Description                                                                                                                                                                                                                                                                                                                         | Default |
|--------------------|-------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|
| **type**           | ``enum(pinch, press, rotate, stroke, swipe)``                                       | *hold* is a deprecated alias for *press*.                                                                                                                                                                                                                                                                                           |         |
| actions            | ``list(Action)``                                                                    | See <a href="#action">*Action*</a> below.                                                                                                                                                                                                                                                                                           |         |
| conditions         | ``list(Condition)``                                                                 | See <a href="#condition">*Condition*</a> below.<br><br>At least one condition (or 0 if none specified) must be satisfied in order for this gesture to be triggered.                                                                                                                                                                 |         |
| edges              | ``flags(left, right, top, bottom, top_left, top_right, bottom_right, bottom_left)`` | List of screen edges/corners, at least one of which the cursor must touch in order for the gesture to be activated.<br><br>Examples:<br>``[ top, left ]`` - Either the top or left edge must be touched, won't work in the top left corner<br>``[ top_left ]`` - Both top and left edge must be touched (top left corner)           |         | 
| fingers            | ``uint`` (exact amount) or ``range(uint)``                                          | The exact amount or range of fingers required to trigger this gesture. Does not apply to mouse gestures. <br><br>Minimum value: *1* for *press* gestures, *2* for *pinch*, *rotate*, *stroke* and *swipe* gestures.<br>Maximum value: Depends on how many fingers the device can detect.                                            | *1*     |
| keyboard_modifiers | ``flags(alt, ctrl, meta, shift)`` or ``enum(any, none)``                            | *any* - Modifiers are ignored<br>*none* - No modifier keys must be pressed<br><br>Keyboard modifiers, all of which must be pressed in order for the gesture to be activated.<br><br>When any gesture with keyboard modifiers is activated, **all** pressed modifiers are released in order to prevent conflicts with input actions. | *any*   |
| mouse_buttons      | ``flags(left, middle, right, back, forward)``                                       | Mouse buttons, all of which must be pressed in order for the gesture to be activated.                                                                                                                                                                                                                                               |         |
| speed              | ``enum(fast, slow)``                                                                | The speed at which the gesture must be performed. Does not apply to press gestures.                                                                                                                                                                                                                                                 |         |
| threshold          | ``float`` (min) or ``range(float)`` (min and max)                                   | How far this gesture needs to progress in order to begin.<br><br>Gestures with *begin* or *update* actions can't have maximum thresholds.                                                                                                                                                                                           |         |


### Rotate gesture
| Property      | Type                                       | Description                                                                         |  Default |
|---------------|--------------------------------------------|-------------------------------------------------------------------------------------|----------|
| **direction** | ``enum(clockwise, counterclockwise, any)`` | *any* is a bi-directional gesture. The direction can be changed during the gesture. |          |

### Pinch gesture
| Property      | Type                   | Description                                                                         |  Default |
|---------------|------------------------|-------------------------------------------------------------------------------------|----------|
| **direction** | ``enum(in, out, any)`` | *any* is a bi-directional gesture. The direction can be changed during the gesture. |          |

### Press gesture
| Property      | Type     | Description                                                                                                                                       | Default |
|---------------|----------|---------------------------------------------------------------------------------------------------------------------------------------------------|---------|
| press_instant | ``bool`` | Whether a press gesture should begin immediately. By default, there is a delay to prevent conflicts with normal clicks and stroke/swipe gestures. | *false* |


### Stroke gesture
| Property   | Type            | Description                                                   |  Default |
|------------|-----------------|---------------------------------------------------------------|----------|
| **stroke** | ``list(float)`` | Strokes can be obtained from the stroke recorder in settings. |          |

### Swipe gesture
| Property      | Type                                                      | Description                                                                                                     |  Default |
|---------------|-----------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------|----------|
| **direction** | ``enum(left, right, up, down, left_right, up_down, any)`` | *any*, *left_right* and *up_down* are bi-directional gestures. The direction can be changed during the gesture. |          |

## Condition
All specified subconditions must be satisfied in order for the condition to be satisfied.  OR conditions can be created by adding multiple conditions.

| Property     | Type                                  | Description                                                                                                                                           | Default |
|--------------|---------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------|---------|
| negate       | ``flags(window_class, window_state)`` | Which properties to negate.                                                                                                                           | *none*  |
| window_class | ``regex``                             | Executed on the currently focused window's resource class and resource name. If a match is not found for either, the condition will not be satisfied. | *none*  |
| window_state | ``flags(fullscreen, maximized)``      |                                                                                                                                                       | *none*  | 

## Action
| Property        | Type                                              | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | Default |
|-----------------|---------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|
| on              | ``enum(begin, end, cancel, update, end_cancel)``  | *begin* - The gesture has started.<br>*end* - The gesture has ended.<br>*cancel* - The gesture has been cancelled, for example due a to a finger being lifted or the direction being changed.<br>*update* - An input event has been sent by the device.<br>*end_cancel* - *end* or *cancel*<br><br>When the action should be triggered.<br>To make a gesture trigger when the fingers are lifted, use *end*.<br>To make a gesture trigger immediately, use *begin*.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               | *end*   |
| interval        | ``float``                                         | How often an *update* action should be repeated. Can be negative for bi-directional gestures.<br><br>If set to 0, the action will execute exactly once per input event. Otherwise, the action may execute 0, if the delta is smaller than the interval, or multiple, if the delta is at least two timer larger than the interval, times per input event.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | *0*     |
| block_other     | ``bool``                                          | Whether this action should block other actions when executed.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | *false* |
| conditions      | ``list(Condition)``                               | List of conditions. See <a href="#condition">*Condition*</a> below.<br><br>At least one condition (or 0 if none specified) must be satisfied in order for this action to be triggered.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            | *none*  |
| threshold       | ``float`` (min) or ``range(float)`` (min and max) | Same as *Gesture.threshold*, but only applied to this action.<br><br>*Begin* actions can't have thresholds.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | *none*  |
| command         | ``string``                                        | Run a command.<br><br>**Mutually exclusive with *input*, *keyboard* and *plasma_shortcut*.**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | *none*  |
| input           |                                                   | List of input devices and the actions to be performed by them. Devices can be used multiple times.<br><br>**Devices**<br>*keyboard*, *mouse*<br><br>**Keyboard and mouse actions**<br>``+[key/button]`` - Press *key* on keyboard or *button* on mouse<br>``-[key/button]`` - Release *key* on keyboard or *button* on mouse<br>``[key1/button1]+[key2/button2]`` - One or more keys/buttons separated by ``+``. Pressed in the order as specified and released in reverse order.<br>Full list of keys and buttons: [src/libgestures/libgestures/yaml_convert.h](../src/libgestures/libgestures/yaml_convert.h)<br><br>**Mouse actions**<br>``move_by [x] [y]`` - Move the pointer by *(x, y)*<br>``move_to [x] [y]`` - Move the pointer to *(x, y)*<br>``move_by_delta`` - Move the pointer by the gesture's delta. Swipe gestures have a different acceleration profile. The delta will be multiplied by *Device.delta_multiplier*.<br><br>Example:<br>``input:``<br>``  - keyboard: [ leftctrl+n ]``<br>`` - mouse: [ left ]``<br><br>**Mutually exclusive with *command*, *keyboard* and *plasma_shortcut*.** | *none*  |
| plasma_shortcut | ``string``                                        | Invoke a KDE Plasma global shortcut. Format: ``component,shortcut``.<br><br>Run ``qdbus org.kde.kglobalaccel \| grep /component`` for the list of components. Don't put the */component/* prefix in this file.<br>Run ``qdbus org.kde.kglobalaccel /component/$component org.kde.kglobalaccel.Component.shortcutNames`` for the list of shortcuts.<br><br>Example: ``kwin,Window Minimize``<br><br>**Mutually exclusive with *command*, *input* and *keyboard*.**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 | *none*  |
| ~~keyboard~~    | ``list(string)``                                  | Like *input* but only for the keyboard.<br><br>**Deprecated. This option is kept for backwards compatibility and may be removed in the future.**<br><br>**Mutually exclusive with *command*, *input* and *plasma_shortcut*.**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     | *none*  |

# Example
```yaml
touchpad:
  speed:
    swipe_threshold: 15

  gestures:
    - type: pinch
      fingers: 2
      direction: in

      actions:
        - plasma_shortcut: kwin,Window Close
```
